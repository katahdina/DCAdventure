<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Simple Red Marker Map</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.css" rel="stylesheet">
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.js"></script>
  <style>
    body { margin: 0; padding: 0; }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; }
  </style>
</head>
<body>

<div id="map"></div>

<script>
  mapboxgl.accessToken = 'pk.eyJ1Ijoiam9tZXJzb24iLCJhIjoiY2o1bXE2bHlyMnJhZDMzbnpyMnhlODdpcSJ9.QJMJ_cTFCY050aZfSn1umQ';

  const bounds = [[-77.26383, 38.69854], [-76.83569, 39.05114]];

  const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v12',
    center: [-77.02, 38.877],
    zoom: 12.9,
    minZoom: 11.5,
    maxZoom: 18,
    maxBounds: bounds
  });

  const locationLookup = {
    jefferson: [-77.0365286, 38.8812811],
    capitol: [-77.0090067, 38.8897276],
    whitehouse: [-77.0365893, 38.8977014],
    washmon: [-77.0352072, 38.8894288],
    lincoln: [-77.0501081, 38.8892558],
    dca: [-77.0398149, 38.8520634]
  };

  const route = [[-77.0428934,38.8550373], //1st leg
    [-77.0443847,38.8547031],
    [-77.0453664,38.8544775],
    [-77.0454737,38.8543981],
    [-77.0455219,38.8542728],
    [-77.0455809,38.8540388],
    [-77.0456346,38.8538216],
    [-77.0457419,38.8537339],
    [-77.0458331,38.8536879],
    [-77.0459511,38.8536921],
    [-77.046053,38.8537422],
    [-77.0460584,38.8538258],
    [-77.0458867,38.8546112],
    [-77.0459725,38.8547323],
    [-77.0458653,38.855242],
    [-77.0458411,38.8554768],
    [-77.0459216,38.855598],
    [-77.0458572,38.8557066],
    [-77.0457392,38.8557985],
    [-77.0457231,38.8559531],
    [-77.0457901,38.8560202],
    [-77.0458679,38.8560557],
    [-77.0459537,38.8561016],
    [-77.0460368,38.8561455],
    [-77.0461119,38.8561956],
    [-77.0461763,38.8562123],
    [-77.0462273,38.8562687],
    [-77.046246,38.8564087],
    [-77.046297,38.8565695],
    [-77.0463399,38.8567178],
    [-77.0464392,38.8568536],
    [-77.0465536,38.8570032],
    [-77.0467387,38.8571787],
    [-77.0468943,38.8573144],
    [-77.0471062,38.8574982],
    [-77.0472912,38.8576424],
    [-77.047499,38.8578081],
    [-77.0476411,38.8580149],
    [-77.0477216,38.8581297],
    [-77.0478128,38.8582049],
    [-77.047904,38.8582404],
    [-77.048026,38.8582415],
    [-77.0481976,38.858229],
    [-77.0483532,38.8581998],
    [-77.0485088,38.8581622],
    [-77.0486858,38.8581496],
    [-77.0489272,38.8581789],
    [-77.0491364,38.8582666],
    [-77.0491418,38.858417],
    [-77.0491172,38.8591505],
    [-77.0491494,38.859656],
    [-77.049321,38.8602199],
    [-77.0493908,38.8608005],
    [-77.0492823,38.8611722],
    [-77.0491317,38.8614523],
    [-77.0488957,38.861824],
    [-77.0487723,38.8620914],
    [-77.0486918,38.8622835],
    [-77.0487133,38.8623503],
    [-77.048606,38.8624005],
    [-77.0484611,38.8623879],
    [-77.0482734,38.8627472],
    [-77.0480695,38.863169],
    [-77.0476779,38.8639167],
    [-77.0472005,38.8647604],
    [-77.0466355,38.8655929],
    [-77.0450905,38.8674391],
    [-77.0436636,38.869068],
    [-77.0427195,38.8701455],
    [-77.0424759,38.870473],
    [-77.0419931,38.8706651],
    [-77.0413172,38.871442],
    [-77.0411241,38.8716341],
    [-77.0414352,38.8718179],
    [-77.042036,38.8723859],
    [-77.0430761,38.873479],
    [-77.043634,38.8740052],
    [-77.0439303,38.8741931],
    [-77.0443326,38.874356],
    [-77.044558,38.8744395],
    [-77.0448476,38.8745147],
    [-77.0449335,38.8744812],
    [-77.0449656,38.8743768],
    [-77.0447725,38.8743142],
    [-77.0444024,38.8742014],
    [-77.0442146,38.8742014],
    [-77.0439893,38.874285],
    [-77.0438874,38.8743685],
    [-77.0437479,38.8743643],
    [-77.0430881,38.875045],
    [-77.040206,38.8780274],
    [-77.0394282,38.8787875],
    [-77.0391206,38.8790532],
    [-77.0387988,38.8792119],
    [-77.0387344,38.8793372],
    [-77.0382516,38.8795711],
    [-77.0378761,38.8797298],
    [-77.0373289,38.8797465],
    [-77.0371036,38.8797966],
    [-77.0370822,38.8804981],
    [-77.0370607,38.8807069],
    [-77.0373445,38.8810344],
    [-77.0374947,38.8814353],
    [-77.0374089,38.8816692],
    [-77.0371943,38.8819531],
    [-77.0367866,38.8821035],
    [-77.0365076,38.8821202],
    [-77.0365076,38.8821202],
    [-77.0362114,38.8820766],
    [-77.0359861,38.881968],
    [-77.0357286, 38.8817676],
    [-77.0356052,38.8815087],
    [-77.0356266,38.8812707],
    [-77.0356964,38.8810869],
    [-77.0352189,38.8813124],
    [-77.0342963,38.8818511],
    [-77.0339637,38.8818845],
    [ -77.0332395,38.882561],
    [ -77.0329069,38.8830412],
    [-77.0328908,38.8833085],
    [-77.0329176, 38.8834755],
    [ -77.032746, 38.8836885],
    [-77.0324831,38.8838096],
    [-77.0316864,38.8833778],
    [-77.0315496,38.8834718],
    [-77.0317401,38.8836096 ],
    [ -77.0317991,38.8837975 ],
    [ -77.0317584,38.8843929],
    [ -77.0317464,38.8849732],
    [ -77.0296167,38.8849836 ],
    [ -77.0295685, 38.8854638],
    [ -77.0295577, 38.8859524],
    [ -77.0280611, 38.8859733],
    [  -77.0279716, 38.8870131],
    [ -77.0278858, 38.8873472],
    [ -77.0276712,  38.887439],
    [  -77.0267378, 38.8874891],
    [ -77.022854,  38.8874891],
    [  -77.0206814,  38.8874975],
    [  -77.0206277,  38.8876603 ],
    [ -77.0174738, 38.8876525],
    [  -77.0172485, 38.8877652],
    [  -77.016181, 38.8880575],
    [ -77.0158489, 38.8880656],
    [ -77.0150872, 38.8882952],
    [  -77.0147546, 38.8884873],
    [  -77.0145561, 38.8887462],
    [ -77.0144971, 38.8890385],
    
//2nd leg
    [-77.0145024,38.8898652],
    [-77.015124,38.8906386],
    [-77.0150891, 38.8910812],
    [-77.0152554, 38.891166],
    [-77.0152581, 38.8913518],
    [-77.0175, 38.8919461],
    [-77.0187821,38.8923034],
    [-77.0190021, 38.892199],
    [-77.0191898, 38.8921489],
    [-77.0195814, 38.8921405],
    [-77.0255547, 38.892139],
    [-77.0258015, 38.8921871],
    [-77.0258873, 38.892329],
    [-77.0260885, 38.8924167],
    [-77.0260751, 38.8942878],
    [-77.0279235, 38.8948183],
    [-77.0293933,38.8952275],
    [-77.029801, 38.895336],
    [-77.0300604, 38.8953795],
    [-77.0304735, 38.895392 ],
    [ -77.0307229, 38.8953983],
    [-77.0307793, 38.8956384],
    [-77.031769, 38.8956384],
    [ -77.0318843, 38.8956906],
    [-77.0320828, 38.8956885],
    [ -77.032765, 38.895946 ],
    [-77.033567, 38.8963635],
    [ -77.0337494, 38.8963865],
//3rd leg
  [-77.033567, 38.8963635],
  [-77.0337494, 38.8963865],
  [-77.0337222, 38.8963291],
  [-77.0337303, 38.8954169],
  [-77.0338858, 38.8953417],
  [-77.0341862, 38.8951914],
  [-77.0344295, 38.894884],
  [-77.0345797, 38.8946084],
  [-77.0346548, 38.8943746],
  [-77.034569, 38.894074],
  [-77.0345261, 38.8938068],
  [-77.0346119, 38.8935479],
  [-77.0347836, 38.8930218],
  [-77.0346119, 38.8927546],
  [-77.0349445, 38.8923371],
  [-77.0354487, 38.892287],
  [-77.0354702, 38.8918945],
  
//4th leg
  [-77.0354702, 38.8918945],
  [-77.0354916, 38.8914011],
  [-77.0352663, 38.8895055],
  [-77.0409224, 38.8893948],
  [-77.0409761, 38.8894282],
  [-77.0411102, 38.8896035],
  [-77.0411531, 38.8896537],
  [-77.0482541, 38.8895408],
  [-77.0485733, 38.8894636],
  [-77.0489756, 38.8894281],
  [-77.0492143, 38.8892924],
  [-77.0501585, 38.8892736],
//5th leg
  [-77.0501585, 38.8892736],
  [-77.0492143, 38.8892924],
  [-77.0488338, 38.8889437],
  [-77.0487909, 38.8888059],
  [-77.0487158, 38.8886138],
  [-77.0485012, 38.8883925],
  [-77.0481954, 38.8881921],
  [-77.0478628, 38.8880042],
  [-77.0477824, 38.8878956],
  [-77.0475624, 38.8878539],
  [-77.0474498, 38.8878414],
  [-77.0472996, 38.8878873],
  [-77.0471923, 38.8878748],
  [-77.0471225, 38.8878414],
  [-77.0469868, 38.8878234],
  [-77.0467105, 38.8878985],
  [-77.0464209, 38.8879277],
  [-77.0462733, 38.8878588],
  [-77.0462143, 38.8877127],
  [-77.046209, 38.8874956],
  [-77.0462733, 38.8873536],
  [-77.0463431, 38.8871991],
  [-77.0464933, 38.8867941],
  [-77.0466113, 38.8867648],
  [-77.0467508, 38.8867231],
  [-77.046783, 38.8865686],
  [-77.0467603, 38.8862941],
  [-77.0455372, 38.8842146],
  [-77.04543, 38.8831122],
  [-77.0440768, 38.8820621],
  [-77.0419525, 38.8805922],
  [-77.0419203, 38.8803541],
  [-77.0417218, 38.8802163],
  [-77.0414214, 38.8800952],
  [-77.0411156, 38.8801161],
  [-77.0408528, 38.8801954],
  [-77.0406328, 38.8802622],
  [-77.0404773, 38.8802915],
  [-77.0398228, 38.8799574],
  [-77.0396726, 38.8798029],
  [-77.0396834, 38.8796061],
  [-77.0392247, 38.8793138],
  [-77.0390074, 38.879391],
  [-77.0388841, 38.8793158],
  [-77.0388626, 38.8792511],
  [-77.0388277, 38.8791989],
  [-77.0391206, 38.8790532],
  [-77.0437479, 38.8743643],
  [-77.0438874, 38.8743685],
  [-77.0439893, 38.874285],
  [-77.0441969, 38.8742026],
  [-77.0444021, 38.8742057],
  [-77.0449694, 38.874374],
  [-77.0449637, 38.8744617],
  [-77.0449335, 38.8745022],
  [-77.0448561, 38.874523],
  [-77.0444175, 38.8743821],
  [-77.0439303, 38.8741895],
  [-77.0437942, 38.8741162],
  [-77.0436282, 38.8739909],
  [-77.0415984, 38.8719696],
  [-77.0409091, 38.8714789],
  [-77.0403029, 38.8695702],
  [-77.0398637, 38.8685689],
  [-77.0398208, 38.8678338],
  [-77.0399174, 38.867082],
  [-77.0401105, 38.8664972],
  [-77.0404753, 38.8658624],
  [-77.0408079, 38.865428],
  [-77.0425996, 38.8636987],
  [-77.0445697, 38.861836],
  [-77.0452445, 38.8607731],
  [-77.0454806, 38.8598876],
  [-77.0453196, 38.8595033],
  [-77.0455664, 38.8593779],
  [-77.0456415, 38.8591774],
  [-77.0453411, 38.8582751],
  [-77.0451238, 38.8577237],
  [-77.0451156, 38.8574544],
  [-77.0446757, 38.8564811],
  [-77.0447166, 38.8562216],
  [-77.0444663, 38.8557122],
  [-77.0440516, 38.8547909],
  [-77.0428446, 38.8550458]
    
];

    // Interpolate route points
  function interpolateCoordinates(coords, resolution = 1) {
    const interpolated = [];
    for (let i = 0; i < coords.length - 1; i++) {
      const startPt = map.project(coords[i]);
      const endPt = map.project(coords[i + 1]);
      const dx = endPt.x - startPt.x;
      const dy = endPt.y - startPt.y;
      const steps = Math.floor(Math.sqrt(dx * dx + dy * dy) / resolution);

      for (let j = 0; j < steps; j++) {
        const t = j / steps;
        const x = startPt.x + t * dx;
        const y = startPt.y + t * dy;
        interpolated.push(map.unproject([x, y]).toArray());
      }
    }
    interpolated.push(coords.at(-1));
    return interpolated;
  }

  function animateLine(sourceId, coords) {
    const pixelCoords = interpolateCoordinates(coords, 1.5);
    let index = 0, chunkSize = 2;

    function step() {
      if (index <= pixelCoords.length) {
        map.getSource(sourceId).setData({
          type: 'Feature',
          geometry: { type: 'LineString', coordinates: pixelCoords.slice(0, index) }
        });
        index += chunkSize;
        requestAnimationFrame(step);
      }
    }
    step();
  }

  map.on('load', () => {
    // Add red markers
    Object.entries(locationLookup).forEach(([id, coords]) => {
      const marker = new mapboxgl.Marker({ color: 'red' })
        .setLngLat(coords)
        .addTo(map);

      marker.getElement().style.cursor = 'pointer';
      marker.getElement().addEventListener('click', () => {
        window.parent.postMessage({ type: 'marker-click', id }, '*');
        map.flyTo({ center: coords, zoom: 15, speed: 1.2, curve: 1.5, essential: true });
      });
    });

    // Add animated route source/layer
    map.addSource('animated-route', {
      type: 'geojson',
      data: { type: 'Feature', geometry: { type: 'LineString', coordinates: [] } }
    });

    map.addLayer({
      id: 'animated-route-layer',
      type: 'line',
      source: 'animated-route',
      layout: { 'line-join': 'round', 'line-cap': 'round' },
      paint: { 'line-color': '#1847c7', 'line-width': 4 }
    });
  });

  window.addEventListener('message', (event) => {
  const { type, id } = event.data || {};

  if (type === 'fly-to' && locationLookup[id]) {
    map.flyTo({ center: locationLookup[id], zoom: 15, speed: 1.2, curve: 1.5, essential: true });
  }

  if (type === 'start-animation' || type === 'animate-footprints') {
  const currentZoom = map.getZoom();

  map.setLayoutProperty('animated-route-layer', 'visibility', 'visible');

  if (currentZoom > 14) {
    map.flyTo({
      zoom: 13,
      speed: 1.2,
      curve: 1.5,
      essential: true,
      center: map.getCenter()
    });
    map.once('moveend', () => animateLine('animated-route', route));
  } else {
    animateLine('animated-route', route);
  }
}

    if (type === 'hide-animation') {
        if (map.getLayer('animated-route-layer')) {
            map.setLayoutProperty('animated-route-layer', 'visibility', 'none');
        }
    }

  if (type === 'reset-view') {
    map.flyTo({ center: [-77.02, 38.877], zoom: 12.9, speed: 1.2, curve: 1.5, essential: true });
  }
});
  
</script>

</body>
</html>